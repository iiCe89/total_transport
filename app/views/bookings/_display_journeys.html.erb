<% @journeys.each_pair do |date, journeys| %>
  <div class="date">
    <h3><%= friendly_date date %></h3>
  </div>
  <% journeys.each do |journey| %>
      <div class="single-journey card<%= ' unavailable' if journey.full? %>">
        <%= form.label field, :value => journey.id do %>
        <%= form.radio_button field, journey.id, class: "journey-select" %>
        <div class="inner">
          <div class="half">
            <span class="timeEst"><%= @booking.pickup_stop.time_for_journey(journey).strftime("%l:%M%P") %></span><br/>
            <span class="small grey">+/- 10 min</span>
          </div>
          <div class="half">
            <span class="timeEst"><%= @booking.dropoff_stop.time_for_journey(journey).strftime("%l:%M%P") %></span><br/>
            <span class="small grey">+/- 10 min</span>
          </div>
        </div>
        <% if journey.seats_left < 4 && journey.seats_left > 0 %>
          <div class="seats-left">
            <span>Only <%= pluralize journey.seats_left, "seat" %> left</span>
          </div>
        <% elsif journey.full? %>
          <div class="fully-booked">
            <span>Fully booked</span>
          </div>
        <% end %>
      <% end %>
    </div>
  <% end %>
<% end %>

<script type="text/javascript">
  $('.single-journey label').click(function(e) {
    var parent = $(this).parent();
    if (parent.hasClass('unavailable')) {
      e.preventDefault();
    } else {
      if ($('input[type="submit"]').hasClass('disabled')) {
        $('input[type="submit"]').removeClass('disabled').attr('disabled', false);
      }
      $('.single-journey.selected').removeClass('selected');
      parent.addClass('selected');
    }
  });
</script>
